<!DOCTYPE html>
<html>
<head>
    <title>Spiritual Service Form</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f1f3f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .form-container {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
        }
        h2 {
            color: #202124;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #dfe1e5;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="submit"] {
            background-color: #1a73e8;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
        }
        input[type="submit"]:hover {
            background-color: #1558b0;
        }
        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .edit-link {
            display: none;
            margin-top: 20px;
        }
        .satsang {
            border-radius: 4px;
        }
    </style>
    <script>
        function setTimestamp() {
            document.getElementById('timestamp').value = new Date().toISOString();
        }

        function validateForm(event) {
            var form = document.querySelector('form');
            var elements = form.elements;
            var isValid = true;
            
            // Clear any previous error messages
            var errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(function(msg) {
                msg.textContent = '';
            });
            
            for (var i = 0; i < elements.length; i++) {
                var el = elements[i];
                var errorMessage = document.querySelector(`#${el.id}-error`);
                if (el.hasAttribute('required') && !el.value) {
                    isValid = false;
                    errorMessage.textContent = 'यह अनिवार्य है';
                }
            }
            
            if (!isValid) {
                event.preventDefault(); // Prevent form submission if validation fails
            }
        }

        function handleSubmit(event) {
            event.preventDefault();
            setTimestamp();
            if (validateForm(event)) {
                var form = event.target;
                var formData = new FormData(form);
                fetch(form.action, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    var editLink = document.getElementById('edit-link');
                    editLink.href = data.editLink;
                    editLink.style.display = 'block';
                })
                .catch(error => console.error('Error:', error));
            }
        }

        function updateSatsangColor() {
            var satsangSelect = document.getElementById('satsang');
            var satsangContainer = document.querySelector('.satsang-container');
            if (satsangSelect.value === 'हां') {
                satsangContainer.style.backgroundColor = 'green';
                satsangContainer.style.color = 'white';
            } else if (satsangSelect.value === 'नहीं') {
                satsangContainer.style.backgroundColor = 'red';
                satsangContainer.style.color = 'white';
            } else {
                satsangContainer.style.backgroundColor = '';
                satsangContainer.style.color = '';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            var form = document.querySelector('form');
            form.addEventListener('submit', handleSubmit);

            var satsangSelect = document.getElementById('satsang');
            satsangSelect.addEventListener('change', updateSatsangColor);
        });
    </script>
</head>
<body>

<div class="form-container">
    <h2>Spiritual Service Form</h2>

    <form action="YOUR_WEB_APP_URL" method="post">
        <label for="name">Name:</label>
        <input type="text" id="name" name="Name" required placeholder="Please enter your name">
        <div id="name-error" class="error-message"></div>
        
        <label for="group">Group Name:</label>
        <select id="group" name="Group Name" required>
            <option value="">Select</option>
            <option value="01">01</option>
            <option value="02">02</option>
            <option value="03">03</option>
            <option value="04">04</option>
            <option value="05">05</option>
        </select>
        <div id="group-error" class="error-message"></div>
        
        <label for="team">Team:</label>
        <select id="team" name="Team" required>
            <option value="">Select</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="G">G</option>
            <option value="H">H</option>
            <option value="I">I</option>
        </select>
        <div id="team-error" class="error-message"></div>
        
        <div class="satsang-container" style="padding: 10px; border: 1px solid #dfe1e5; border-radius: 4px;">
            <label for="satsang">आपने सत्संग सुना:</label>
            <select id="satsang" name="आपने सत्संग सुना" required class="satsang">
                <option value="">Select</option>
                <option value="हां">हां</option>
                <option value="नहीं">नहीं</option>
            </select>
            <div id="satsang-error" class="error-message"></div>
        </div>
        
        <label for="twitter">ट्विटर पोस्ट सेवा:</label>
        <input type="number" id="twitter" name="ट्विटर पोस्ट सेवा" required placeholder="Enter the number of tweets">
        <div id="twitter-error" class="error-message"></div>
        
        <!-- Hidden field to store timestamp -->
        <input type="hidden" id="timestamp" name="Timestamp">
        <!-- Hidden field to store unique ID -->
        <input type="hidden" id="unique-id" name="UniqueID" value="<?!= getIdParameter(); ?>">

        <input type="submit" value="Submit">
    </form> 

    <a id="edit-link" href="#" class="edit-link">Edit your response</a>
</div>

<script>
    function getIdParameter() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id') || '';
    }
</script>

</body>
</html>
